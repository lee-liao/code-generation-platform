(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[10],{5144:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"w-full h-full px-12"},[r("div",{staticStyle:{width:"100%",margin:"15px 0",display:"flex","justify-content":"space-between"}},[r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:t.$t("People.searchForName")},on:{input:t.handleInputSearch},model:{value:t.searchValue,callback:function(e){t.searchValue=e},expression:"searchValue"}},[r("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),r("div",[1==t.currentUser.role?r("el-button",{attrs:{type:"primary"},on:{click:t.gotoDistributorDetail}},[t._v("\n        "+t._s(t.$t("mainlayout.DistributorSplitRatios"))+"\n      ")]):t._e(),1==t.currentUser.role?r("el-button",{attrs:{type:"primary"},on:{click:t.handleCreate}},[t._v("\n        "+t._s(t.$t("Distributor.addDistributor"))+"\n      ")]):t._e()],1)],1),r("div",[r("el-table",{staticClass:"mb-5",staticStyle:{width:"100%"},attrs:{data:t.tableData.slice((t.currentPage-1)*t.pageSize,t.currentPage*t.pageSize),loading:t.Loading,"empty-text":t.$t("People.noData")}},[r("el-table-column",{attrs:{label:t.$t("Distributor.name"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(t._s(e.row.name))])]}}])}),r("el-table-column",{attrs:{prop:"desc",label:t.$t("Distributor.describe"),align:"center"}}),r("el-table-column",{attrs:{label:t.$t("register.username"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.user.name)+"\n        ")]}}])}),5!=t.currentUser.role||null==t.currentUser.distributor.t1DistributorId?r("el-table-column",{attrs:{label:t.$t("Distributor.grade"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.t1Distributor?e.row.t1Distributor.name:"")+"\n        ")]}}],null,!1,2092890033)}):t._e(),r("el-table-column",{attrs:{prop:"createdAt",label:t.$t("People.createdAt"),align:"center",formatter:t.formatterTime}}),r("el-table-column",{attrs:{label:"Url","show-overflow-tooltip":"",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("i",{staticClass:"el-icon-document-copy ml-3 cursor-pointer",on:{click:function(r){return t.handlecopy("https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket="+e.row.wxQrCode)}}}),t._v("\n          "+t._s("https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket="+e.row.wxQrCode)+"\n        ")]}}])}),r("el-table-column",{attrs:{label:t.$t("Distributor.wxQrCode"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(t){return[r("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:"https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket="+t.row.wxQrCode}})]}}])}),5!=t.currentUser.role||null==t.currentUser.distributor.t1DistributorId?r("el-table-column",{attrs:{label:t.$t("Distributor.t2QrCode"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[null!=e.row.t2QrCode?r("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.row.t2QrCode}}):t._e()]}}],null,!1,1599820410)}):t._e(),1==t.currentUser.role?r("el-table-column",{attrs:{label:t.$t("People.action"),align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"text"},on:{click:function(r){return t.handleEdit(e.$index,e.row,"parent")}}},[t._v("\n            "+t._s(t.$t("People.edit"))+"\n          ")]),r("el-button",{attrs:{type:"text"},on:{click:function(r){return t.handleDelete(e.$index,e.row)}}},[t._v("\n            "+t._s(t.$t("People.delete"))+"\n          ")])]}}],null,!1,3602891684)}):t._e()],1),r("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[5,10,20,50],"page-size":t.pageSize,total:t.tableData.length,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),r("el-dialog",{staticClass:"channel-dialog",attrs:{"close-on-click-modal":!1,visible:t.dialogPeopleVisible,title:t.createOrEditTitle,width:t.isMobile?"calc(100vw - 54px)":"calc(55% - 260px)","append-to-body":!0},on:{"update:visible":function(e){t.dialogPeopleVisible=e}}},[r("el-form",{ref:"peopleForm",attrs:{model:t.distributorInfo,rules:t.peopleRules,"label-width":"180px","label-position":"left"}},[r("el-form-item",{attrs:{label:t.$t("Distributor.name"),prop:"name"}},[r("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,autocomplete:"off"},model:{value:t.distributorInfo.name,callback:function(e){t.$set(t.distributorInfo,"name",e)},expression:"distributorInfo.name"}})],1),r("el-form-item",{attrs:{label:t.$t("Distributor.describe"),prop:"describe"}},[r("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,autocomplete:"off"},model:{value:t.distributorInfo.desc,callback:function(e){t.$set(t.distributorInfo,"desc",e)},expression:"distributorInfo.desc"}})],1),r("el-form-item",{attrs:{label:t.$t("register.username"),prop:"username"}},[r("el-input",{staticClass:"channel-input",attrs:{disabled:t.isEidt,"validate-event":!1,autocomplete:"off"},model:{value:t.distributorInfo.username,callback:function(e){t.$set(t.distributorInfo,"username",e)},expression:"distributorInfo.username"}})],1),r("el-form-item",{attrs:{label:t.$t("register.email"),prop:"email"}},[r("el-input",{staticClass:"channel-input",attrs:{disabled:t.isEidt,"validate-event":!1,autocomplete:"off"},model:{value:t.distributorInfo.email,callback:function(e){t.$set(t.distributorInfo,"email",e)},expression:"distributorInfo.email"}})],1),r("el-form-item",{attrs:{label:t.$t("register.phoneNumber"),prop:"phone"}},[r("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,disabled:t.isEidt,autocomplete:"off"},model:{value:t.distributorInfo.phone,callback:function(e){t.$set(t.distributorInfo,"phone",e)},expression:"distributorInfo.phone"}})],1),t.isEidt?t._e():r("el-form-item",{attrs:{label:t.$t("register.password"),prop:"password"}},[r("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,autocomplete:"off"},model:{value:t.distributorInfo.password,callback:function(e){t.$set(t.distributorInfo,"password",e)},expression:"distributorInfo.password"}})],1),t.distributorInfo.t2QrCode||!t.isEidt?r("el-form-item",{attrs:{label:t.$t("Distributor.t1SplitRatio"),prop:"distributorSplitRatioId"}},[r("el-select",{attrs:{clearable:""},model:{value:t.distributorInfo.distributorSplitRatioId,callback:function(e){t.$set(t.distributorInfo,"distributorSplitRatioId",e)},expression:"distributorInfo.distributorSplitRatioId"}},t._l(t.SplitRatios,(function(t){return r("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e(),t.distributorInfo.t2QrCode||!t.isEidt?r("el-form-item",{attrs:{label:t.$t("Distributor.t2SplitRatio"),prop:"distributorSplitRatio2Id"}},[r("el-select",{attrs:{clearable:""},model:{value:t.distributorInfo.distributorSplitRatio2Id,callback:function(e){t.$set(t.distributorInfo,"distributorSplitRatio2Id",e)},expression:"distributorInfo.distributorSplitRatio2Id"}},t._l(t.SplitRatios,(function(t){return r("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e(),t.distributorInfo.t2QrCode||!t.isEidt?r("el-form-item",{attrs:{label:t.$t("Distributor.t3SplitRatio"),prop:"distributorSplitRatio3Id"}},[r("el-select",{attrs:{clearable:""},model:{value:t.distributorInfo.distributorSplitRatio3Id,callback:function(e){t.$set(t.distributorInfo,"distributorSplitRatio3Id",e)},expression:"distributorInfo.distributorSplitRatio3Id"}},t._l(t.SplitRatios,(function(t){return r("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1):t._e()],1),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.dialogPeopleVisible=!1}}},[t._v(t._s(t.$t("People.cancel")))]),r("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmitMessage}},[t._v(t._s(t.$t("People.confirm")))])],1)],1)],1)},a=[],l=r("750b"),o=r("b850"),s=r("1840"),n=r("5a0c"),u=r.n(n),d=r("6eb7"),c=r("436b"),p=r("cdde"),b=r("45c1"),m=r("159f"),f=r("fadb"),v=Object(l["defineComponent"])({data(){return{isMobile:Object(f["a"])()}},mounted(){Object(f["b"])(this,"isMobile")},setup(t,{root:e}){const r=Object(l["ref"])(!1),i=Object(l["ref"])([]),a=Object(l["computed"])(o["b"].currentUser),n=Object(l["ref"])([]),{mutate:f}=Object(s["useMutation"])(m["c"]),v=Object(l["ref"])([]),g=async()=>{try{const{data:{getOrgDistributorSplitRatios:t}}=await f();v.value=t}catch(t){console.log("----------getPeople error")}},h=Object(l["ref"])(!1),I=t=>{Object(p["a"])(t),d["a"].success(e.$t("flow.CopySuccess"))},{mutate:S}=Object(s["useMutation"])(b["l"]),$=async()=>{try{r.value=!0;const{data:{getOrgDistributors:t}}=await S();i.value=t,n.value=t,5==a.value.role&&(a.value.distributor&&a.value.distributor.t1DistributorId&&(h.value=!0),null!=t[0].t2Distributors&&t[0].t2Distributors.forEach((e=>{n.value.push(e),n.value.forEach((e=>{if(null!=e.t1DistributorId){let r={name:t[0].name};e.t1Distributor=r}}))}))),console.log(n.value),r.value=!1}catch(t){console.log("----------getPeople error")}},w=()=>{e.$router.push("/distributorSplitRatios")},R=(t,e="YYYY/MM/DD  HH:mm:ss")=>t?u()(t).format(e):t,D=t=>{let e=R(t.createdAt);return e},_=t=>{switch(t.role){case 1:return e.$t("People.Administrators");case 2:return e.$t("People.Lawyer");case 3:return e.$t("People.Operator");case 4:return e.$t("People.Finance");case 5:return e.$t("People.Distributor");case 6:return e.$t("People.DistributorAdmin")}},y=[{value:1,label:e.$t("People.Administrators")},{value:2,label:e.$t("People.Lawyer")},{value:3,label:e.$t("People.Operator")},{value:4,label:e.$t("People.Finance")},{value:5,label:e.$t("People.Distributor")},{value:6,label:e.$t("People.DistributorAdmin")}],P=Object(l["ref"])(""),x=()=>{n.value=i.value.filter((t=>t.name.includes(P.value))),console.log(P.value,n.value)},C=Object(l["ref"])(!1),k=Object(l["ref"])(""),O=Object(l["ref"])({name:"",desc:"",distributorSplitRatioId:"",distributorSplitRatio2Id:"",distributorSplitRatio3Id:"",username:"",email:"",phone:"",password:"",t2QrCode:""}),j=()=>{M.value=!1,E.value=!1,k.value=e.$t("People.add"),O.value={...O.value,name:"",desc:"",distributorSplitRatioId:"",distributorSplitRatio2Id:"",distributorSplitRatio3Id:"",username:"",email:"",phone:"",password:""},C.value=!0},q=Object(l["ref"])(""),E=Object(l["ref"])(!1),M=Object(l["ref"])(!1),N=(t,r,i)=>{M.value=!0,E.value="child"==i,k.value=e.$t("People.edit"),O.value={name:r.name,desc:r.desc,username:r.user.name,email:r.user.email,phone:r.user.phone,distributorSplitRatioId:r.distributorSplitRatioId,distributorSplitRatio2Id:r.distributorSplitRatio2Id,distributorSplitRatio3Id:r.distributorSplitRatio3Id,t2QrCode:r.t2QrCode},q.value=r.id,console.log(q.value),C.value=!0},Q=Object(l["ref"])(null),z={name:[{required:!0,message:e.$t("Distributor.DistributorMessage"),trigger:"blur"}],username:[{required:!0,message:e.$t("register.invaildName"),trigger:"blur"}],email:[{required:!0,message:e.$t("register.emailRequire"),trigger:"blur"}],phone:[{required:!0,message:e.$t("register.PhoneRequire"),trigger:"blur"}],password:[{required:!M,message:e.$t("register.EnterNewPassword"),trigger:"blur"}]},{mutate:U}=Object(s["useMutation"])(b["b"]),{mutate:V}=Object(s["useMutation"])(b["q"]),A=()=>{Q.value&&Q.value.validate((async t=>{if(t)try{if(0==Number(O.value.distributorSplitRatioId))return d["a"].error("请选择一级发展用户的分成比例"),!1;if(0==Number(O.value.distributorSplitRatio2Id))return d["a"].error("请选择二级发展用户的分成比例"),!1;if(0==Number(O.value.distributorSplitRatio3Id))return d["a"].error("请选择二级发展给一级分成比例"),!1;let t={name:O.value.name,desc:O.value.desc,distributorSplitRatioId:0==Number(O.value.distributorSplitRatioId)?null:Number(O.value.distributorSplitRatioId),distributorSplitRatio2Id:0==Number(O.value.distributorSplitRatio2Id)?null:Number(O.value.distributorSplitRatio2Id),distributorSplitRatio3Id:0==Number(O.value.distributorSplitRatio3Id)?null:Number(O.value.distributorSplitRatio3Id)},r={name:O.value.username,email:O.value.email,phone:O.value.phone,password:O.value.password,avatarUrl:"https://file.sflow.pro/avatar_default.png"};if(k.value==e.$t("People.add")){const i=await U({user:r,distributor:t});console.log(i),$(),d["a"].success(e.$t("People.succeed"))}else{const r=await V({distributor:t,id:q.value});console.log(r),$(),d["a"].success(e.$t("People.succeed"))}C.value=!1,O.value={name:"",desc:""},console.log(O.value)}catch(r){d["a"].error(r.message)}}))},{mutate:F}=Object(s["useMutation"])(b["c"]),T=async(t,r)=>{c["a"].create({title:e.$t("People.confirm"),message:e.$t("Distributor.confirmDeleteDistributor"),ok:{label:e.$t("People.confirm"),noCaps:!0},cancel:{label:e.$t("People.cancel"),noCaps:!0,flat:!0},style:{zIndex:10002}}).onOk((async()=>{d["a"].success(e.$t("People.succeed")),await F({id:r.id}),$(),d["a"].success(e.$t("People.succeed"))}))},L=Object(l["ref"])(1),Y=Object(l["ref"])(10),H=t=>{Y.value=t},J=t=>{L.value=t};return Object(l["onMounted"])((()=>{g(),$()})),{tableData:n,searchValue:P,isEditChild:E,handleInputSearch:x,currentPage:L,pageSize:Y,getSplitRatios:g,SplitRatios:v,handleSizeChange:H,handleCurrentChange:J,formatterTime:D,formatterRole:_,currentUser:a,roleOptions:y,dialogPeopleVisible:C,handlecopy:I,createOrEditTitle:k,distributorInfo:O,peopleRules:z,gotoDistributorDetail:w,peopleForm:Q,handleCreate:j,handleEdit:N,handleDelete:T,handleSubmitMessage:A,Loading:r,isEidt:M,isT2:h}}}),g=v,h=r("2877"),I=Object(h["a"])(g,i,a,!1,null,"5d55af5b",null);e["default"]=I.exports}}]);