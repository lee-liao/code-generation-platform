(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[26],{"2a8c":function(e,t,a){"use strict";a.r(t);var l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"w-full h-full px-12 "},[a("div",{staticStyle:{width:"100%",margin:"15px 0",display:"flex","justify-content":"space-between"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:e.$t("People.searchForName")},on:{input:e.handleInputSearch},model:{value:e.searchValue,callback:function(t){e.searchValue=t},expression:"searchValue"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})]),1==e.currentUser.role?a("el-button",{attrs:{type:"primary"},on:{click:e.handleCreate}},[e._v("\n        "+e._s(e.$t("People.addPeople"))+"\n      ")]):e._e()],1),a("div",[a("el-table",{staticClass:"mb-5",staticStyle:{width:"100%"},attrs:{data:e.tableData.slice((e.currentPage-1)*e.pageSize,e.currentPage*e.pageSize),border:"",loading:e.Loading,"empty-text":e.$t("People.noData")}},[a("el-table-column",{attrs:{label:e.$t("People.User"),align:"center","min-width":"100%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{width:"100%",display:"flex","align-items":"center","justify-content":"left","margin-left":"10px"}},[a("j-avatar",{staticClass:"shadow-outline-white -ml-1",attrs:{size:28,avatarUrl:t.row.avatarUrl,name:"xxxxx"}}),a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.name))])],1)]}}])}),a("el-table-column",{attrs:{prop:"desc",label:e.$t("register.des"),align:"center","min-width":"100%"}}),a("el-table-column",{attrs:{prop:"phone",label:e.$t("People.Phone"),align:"center","min-width":"100%"}}),a("el-table-column",{attrs:{prop:"realName",label:e.$t("People.realName"),align:"center","min-width":"100%"}}),a("el-table-column",{attrs:{prop:"createdAt",label:e.$t("People.createdAt"),align:"center",formatter:e.formatterTime,"min-width":"165%"}}),a("el-table-column",{attrs:{prop:"role",label:e.$t("People.Authority"),align:"center",formatter:e.formatterRole,"min-width":"100%"}}),1==e.currentUser.role?a("el-table-column",{attrs:{label:e.$t("People.action"),align:"center","min-width":"180%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("\n    "+e._s(e.$t("People.edit"))+"\n  ")]),a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("\n    "+e._s(e.$t("People.delete"))+"\n  ")])]}}],null,!1,1129274068)}):e._e()],1),a("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[5,10,20,50],"page-size":e.pageSize,total:e.tableData.length,layout:"total, sizes, prev, pager, next, jumper"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),a("el-dialog",{staticClass:"channel-dialog",attrs:{"close-on-click-modal":!1,visible:e.dialogPeopleVisible,title:e.createOrEditTitle,width:e.isMobile?"calc(100vw - 54px)":"calc(55% - 260px)","append-to-body":!0},on:{"update:visible":function(t){e.dialogPeopleVisible=t}}},[a("el-form",{ref:"peopleForm",attrs:{model:e.peopleConfigMessage,rules:e.peopleRules,"label-width":"80px","label-position":"top"}},[a("el-form-item",{attrs:{label:e.$t("People.userName"),prop:"name"}},[a("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,autocomplete:"off"},model:{value:e.peopleConfigMessage.name,callback:function(t){e.$set(e.peopleConfigMessage,"name",t)},expression:"peopleConfigMessage.name"}})],1),a("el-form-item",{attrs:{label:e.$t("register.des"),prop:"desc"}},[a("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,autocomplete:"off"},model:{value:e.peopleConfigMessage.desc,callback:function(t){e.$set(e.peopleConfigMessage,"desc",t)},expression:"peopleConfigMessage.desc"}})],1),a("el-form-item",{attrs:{label:e.$t("People.Phone"),prop:"phone"}},[a("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,autocomplete:"off"},model:{value:e.peopleConfigMessage.phone,callback:function(t){e.$set(e.peopleConfigMessage,"phone",t)},expression:"peopleConfigMessage.phone"}})],1),a("el-form-item",{attrs:{label:e.$t("People.email"),prop:"email"}},[a("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,autocomplete:"off"},model:{value:e.peopleConfigMessage.email,callback:function(t){e.$set(e.peopleConfigMessage,"email",t)},expression:"peopleConfigMessage.email"}})],1),e.createOrEditTitle==e.$t("People.add")?a("el-form-item",{attrs:{label:e.$t("People.InitialPassword"),prop:"password",rules:[{required:!0,message:e.$t("People.userInitialPassword"),trigger:"blur"}]}},[a("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,autocomplete:"off"},model:{value:e.peopleConfigMessage.password,callback:function(t){e.$set(e.peopleConfigMessage,"password",t)},expression:"peopleConfigMessage.password"}})],1):e._e(),e.createOrEditTitle!=e.$t("People.add")?a("el-form-item",{attrs:{label:e.$t("People.resetPassword"),prop:"password"}},[a("el-input",{staticClass:"channel-input",attrs:{"validate-event":!1,autocomplete:"off"},model:{value:e.resetPassword,callback:function(t){e.resetPassword=t},expression:"resetPassword"}})],1):e._e(),a("el-form-item",{attrs:{label:e.$t("People.weixinUser"),prop:"password"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",filterable:"",placeholder:e.$t("People.PleaseSelect")},model:{value:e.peopleConfigMessage.wxUserId,callback:function(t){e.$set(e.peopleConfigMessage,"wxUserId",t)},expression:"peopleConfigMessage.wxUserId"}},e._l(e.allWeixinUsers,(function(t){return a("el-option",{key:t.id,attrs:{label:t.name,value:t.id}},[a("j-avatar",{staticClass:"shadow-outline-white -ml-1",attrs:{size:28,avatarUrl:t.avatarUrl,name:"xxxxx"}}),a("span",{staticStyle:{"margin-left":"20px","padding-bottom":"5px"}},[e._v(e._s(t.name))])],1)})),1)],1),a("el-form-item",{attrs:{label:e.$t("People.Authority"),prop:"role"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:e.$t("People.PleaseSelect")},model:{value:e.peopleConfigMessage.role,callback:function(t){e.$set(e.peopleConfigMessage,"role",t)},expression:"peopleConfigMessage.role"}},e._l(e.roleOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogPeopleVisible=!1}}},[e._v(e._s(e.$t("People.cancel")))]),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmitMessage}},[e._v(e._s(e.$t("People.confirm")))])],1)],1)],1)},s=[],o=a("750b"),r=a("b850"),n=a("1840"),i=a("5a0c"),p=a.n(i),c=a("ac79"),u=a("6eb7"),d=a("436b"),m=a("ef50"),f=a("fadb"),g=Object(o["defineComponent"])({data(){return{isMobile:Object(f["a"])()}},mounted(){Object(f["b"])(this,"isMobile")},setup(e,{root:t}){const a=Object(o["ref"])(!1),l=Object(o["ref"])([]),s=Object(o["computed"])(r["b"].currentUser),i=Object(o["ref"])([]),{mutate:f}=Object(n["useMutation"])(m["d"]),{mutate:g}=Object(n["useMutation"])(m["f"]),b=async()=>{try{a.value=!0;const{data:{getUsers:e}}=await f();l.value=e,i.value=e,a.value=!1,console.log(i.value)}catch(e){console.log("----------getPeople error")}},v=Object(o["ref"])([]),h=async()=>{try{const{data:{getWxUsers:e}}=await g();v.value=e}catch(e){console.log("----------getWeixinUsers error")}},w=(e,t="YYYY/MM/DD  HH:mm:ss")=>e?p()(e).format(t):e,P=e=>{let t=w(e.createdAt);return t},$=e=>{switch(e.role){case 1:return t.$t("People.Administrators");case 2:return t.$t("People.Lawyer");case 3:return t.$t("People.Operator");case 4:return t.$t("People.Finance");case 5:return t.$t("People.Distributor");case 6:return t.$t("People.DistributorAdmin")}},x=[{value:1,label:t.$t("People.Administrators")},{value:2,label:t.$t("People.Lawyer")},{value:3,label:t.$t("People.Operator")},{value:4,label:t.$t("People.Finance")},{value:5,label:t.$t("People.Distributor")},{value:6,label:t.$t("People.DistributorAdmin")}],C=Object(o["ref"])(""),M=()=>{i.value=l.value.filter((e=>e.name.includes(C.value))),console.log(C.value,i.value)},U=Object(o["ref"])(!1),y=Object(o["ref"])(""),O=Object(o["ref"])({name:"",email:"",phone:"",avatarUrl:"https://file.sflow.pro/avatar_default.png",role:1,wxUserId:"",desc:""}),j=()=>{y.value=t.$t("People.add"),O.value={...O.value,name:"",email:"",phone:"",password:"",role:1,desc:"",wxUserId:""},U.value=!0},_=Object(o["ref"])(""),I=(e,a)=>{y.value=t.$t("People.edit"),E.value="",O.value={name:a.name,email:a.email,wxUserId:a.wxUserId,phone:a.phone,desc:a.desc,avatarUrl:a.avatarUrl,role:a.role},_.value=a.id,console.log(a.wxUserId),U.value=!0},k=Object(o["ref"])(null),S={name:[{required:!0,message:t.$t("People.userNameMessage"),trigger:"blur"}],phone:[{required:!0,message:t.$t("People.userPhoneMessage"),trigger:"blur"}],email:[{required:!0,message:t.$t("People.userEmailMessage"),trigger:"blur"}]},{mutate:z}=Object(n["useMutation"])(m["a"]),{mutate:D}=Object(n["useMutation"])(m["i"]),E=Object(o["ref"])(""),A=()=>{k.value&&k.value.validate((async e=>{if(e){if(!c["a"].isEmail(O.value.email))return void u["a"].error(t.$t("People.EmailWrong"));if(!c["a"].isMobile(O.value.phone))return void u["a"].error(t.$t("People.PhoneWrong"));try{if(y.value==t.$t("People.add")){O.value.wxUserId=""==O.value.wxUserId?null:O.value.wxUserId;const e=await z({user:O.value});console.log(e),b(),u["a"].success(t.$t("People.succeed"))}else{if(E.value){let e={name:O.value.name,email:O.value.email,phone:O.value.phone,desc:O.value.desc,avatarUrl:O.value.avatarUrl,role:O.value.role,wxUserId:""==O.value.wxUserId?null:O.value.wxUserId,password:E.value};const t=await D({user:e,userId:_.value});console.log(t)}else{O.value.wxUserId=""==O.value.wxUserId?null:O.value.wxUserId;const e=await D({user:O.value,userId:_.value});console.log(e)}b(),u["a"].success(t.$t("People.succeed"))}U.value=!1,O.value={name:"",email:"",phone:"",desc:"",wxUserId:"",avatarUrl:"https://file.sflow.pro/avatar_default.png"},console.log(O.value)}catch(a){u["a"].error(a.message)}}}))},{mutate:V}=Object(n["useMutation"])(m["b"]),T=async(e,a)=>{d["a"].create({title:t.$t("People.confirm"),message:t.$t("People.confirmMessage"),ok:{label:t.$t("People.confirm"),noCaps:!0},cancel:{label:t.$t("People.cancel"),noCaps:!0,flat:!0},style:{zIndex:10002}}).onOk((async()=>{u["a"].success(t.$t("People.succeed")),await V({userId:a.id}),b(),u["a"].success(t.$t("People.succeed"))}))},W=Object(o["ref"])(1),F=Object(o["ref"])(10),N=e=>{F.value=e},q=e=>{W.value=e};return Object(o["onMounted"])((()=>{b(),h()})),{tableData:i,searchValue:C,handleInputSearch:M,currentPage:W,resetPassword:E,pageSize:F,handleSizeChange:N,handleCurrentChange:q,formatterTime:P,formatterRole:$,currentUser:s,roleOptions:x,allWeixinUsers:v,dialogPeopleVisible:U,createOrEditTitle:y,peopleConfigMessage:O,peopleRules:S,peopleForm:k,handleCreate:j,handleEdit:I,handleDelete:T,handleSubmitMessage:A,Loading:a}}}),b=g,v=a("2877"),h=Object(v["a"])(b,l,s,!1,null,"4ff58b63",null);t["default"]=h.exports}}]);